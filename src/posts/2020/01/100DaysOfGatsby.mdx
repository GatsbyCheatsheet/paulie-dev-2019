---
title: 100DaysOfGatsby
tags: ["gatsbyJs"]
date: 2020-01-01
featuredImage: 100DaysOfGatsby.jpg
---

## [Day 8](#day-8)

##### Jan 8 2020

Last night i carried on working on [gatsby-mdx-embed](https://github.com/PaulieScanlon/gatsby-mdx-embed), made some tweaks to the `docz` theme and found a list of "providers" that are supported by oEmbed.

There where two that caught my eye, _SoundCloud_ and _Gist_. SoundCloud was pretty straight forward as it's a very similar method to how _YouTube_ and _Vimeo_ so that was no problem.

This morning i moved on to Gists.

I Googled around to see if there were any existing React repos and found these two... so thanks [Christian Kornd√∂rfer](https://github.com/schnubor) and [Miroslav Saraƒçeviƒá](https://github.com/msaracevic)

The main bit that i didn't initially understand was how to handle the `JSON` callback.

If we start with a typical Gist URL and run it, you'll hit the [https://gist.github.com/](https://gist.github.com/)

```js
https://gist.github.com/PaulieScanlon/ca0cc9239176066492cb2aba435edbf7
```

To provide a callback we can add on `gist_callback` i Googled around for how to add the callback for ages and found no official docs, just examples of how others have done this.

```js
?gist_callback_ca0cc9239176066492cb2aba435edbf7
```

This is now the complete URL.

```js
https://gist.github.com/PaulieScanlon/ca0cc9239176066492cb2aba435edbf7?callback=gist_callback_ca0cc9239176066492cb2aba435edbf7
```

The last step was to inject a `<script>` tag with the URL in a `useEffect` life-cycle method, create a function on the window object called `gist_callback_ca0cc9239176066492cb2aba435edbf7` then investigate the response.

The response comes back with a `div` object which contains all the HTML for the Gist which can be handled by `dangerouslySetInnerHTML`

```js
<div dangerouslySetInnerHTML={{ __html: response.div }} />
```

...and a `stylesheet` object which in turn needs to be injected into the page in a `<link>` tag.

With both of those things done Gists are now embedd-able!

I need to do a bit more work on handling errors but i've bundled it up and Gists are now part of `v0.0.4`

Happy Embedding! üßº

## [Day 7](#day-7)

##### Jan 7 2020

Yesterday was a pretty good day, i was relieved to finally get `docz` setup the way i wanted. I also launched a very early version of [gatsby-mdx-embed](https://github.com/PaulieScanlon/gatsby-mdx-embed). A fellow Gatsby enthusiast who i met at Gatsby Days London [Scott Spence](https://twitter.com/spences10) was keen to try it out... so, here ya go Scott!

<Tweet id="PaulieScanlon/status/1214241819397103618" />

This evening i'll mostly be focussing on documenting and testing the props for each component and perhaps if there's time i'll investigate what other providers i can include. [dev.to](https://dev.to/) would be sweet but i had a quick google and there's an open issue on [GitHub](https://github.com/thepracticaldev/dev.to/issues/1445) regarding this so i don't know if it's possible yet... stay tuned üì∫

## [Day 6](#day-6)

##### Jan 6 2020

Back to my day job today so i got up early and cracked on with the `docz.site`... and pleased to report i got the `<Props>` component working.

I was on the right track with what i thought the problem was and `docz` can be configured to source files from outside the root directory but this hasn't been documented anywhere.

The problem was twofold.

1. What did node think the root was and what is the correct path to pass to `docz`
2. How the WT Flip do you pass a path to `docz`

The way to do point 2 is to add `docgenConfig.searchPath` to `doczrc.js` which tells `docz` where to look for component props. You won't find this in their docs but i did find it amongst the [examples](https://github.com/doczjs/docz/blob/master/examples/monorepo-separate-docs/packages/docs/doczrc.js)

```js
// doczrc.js
export default {
  docgenConfig: {
    searchPath: directoryPath,
  },
}
```

and `directoryPath` is as follows;

```js
const directoryPath = path.join(
  process.cwd(),
  "../@pauliescanlon/gatsby-mdx-embed/src/components"
)
```

First i'm using `path.join` to make sure i don't end up with un-wanted `/`'s, then i'm using `process.cwd` which is the node.js method for working out the **C**urrent **W**orking **D**irectory then finally i go up a level `"../"` and into the yarn workspace where i'm writing my `MdxComponents`

This now means from the `.mdx` file where i'm writing the documentation about the component i can also have a nicely formatted prop table which are the real props defined by `propTypes` in the component file.

You can see the example for the CodePen component [here](https://gatsby-mdx-embed.netlify.com/src-components-code-pen)

Later tonight or early tomorrow i'd like to tweak the `docz` theme styles a bit then finally i can crack on with developing the `MdxComponents`

Oh and dark mode now works! üéâ

## [Day 5](#day-5)

##### Jan 5 2020

Today i decided to focus on the documentation site as i need a `playground` setup so i can test props for each of the `MdxEmbed` components.

Usually in my professional life i'd use [Storybook](https://storybook.js.org/) but since part of [#100DaysOfGatsby](https://twitter.com/hashtag/100DaysOfGatsby) is to learn new things i've gone for using [docz.site](https://www.docz.site/)

It was a bit tricky to setup as i wanted to use [gatsby-theme-docz](https://github.com/doczjs/docz/tree/master/core/gatsby-theme-docz) and i found the documentation regarding setup a bit confusing.

None the less it's all looking pretty good now. I might have found a bug with how the plugin options are passed or perhaps in some cases they have to be set in the `doczrc.js` file... who knows, maybe i'll have to live without dark mode on ths one!

The problem i'm currently experiencing is with the `<Props>` component which is one of the [built-in-components](https://www.docz.site/docs/built-in-components) which can create prop tables for my components. What's not initially made clear is that it'll only work if the component in question is local to the `.mdx`. For example `docz` will generate a prop table for `<MyComponent>` it it's in the same **things** folder as `MyMdx.mdx`

```
 - things
    MyComponent.js
    MyMdx.mdx

```

... But it wont work if i move `<MyComponent>` to somewhere else, for example...

```
- components
  MyComponent.js

- pages
  MyMdx.mdx

```

If you want to be able to source files from somewhere else you have to set the `src` value in `doczrc.js`

```js
export default {
  ...
  src: './components',
}
```

But my docs site and my MdxEmbed project are two different repos linked together by yarn workspaces so i think i need to tell docz to jump up a level to find my components.

```js
export default {
  ...
  src: '../@pauliescanlon/gatsby-mdx-embed/src/components',
}
```

Which causes GraphQL to error, presumably because it can't find what it needs?

I'm currently trying to work out where node thinks the root is and from there i need to refresh my memory about `path.resolve` and `process.cwd` but that sounds like a job for tomorrow!

## [Day 4](#day-4)

##### Jan 4 2020

Yesterday i spent the morning getting lost in a `docs` rabbit hole. I tried numerous documentation themes but all were tripping me up one way or another so i decided to shelve the docs part of [gatsby-mdx-embed](https://github.com/PaulieScanlon/gatsby-mdx-embed) and just get something looking half decent... which led me down another rabbit hole. I had real trouble getting theme-ui and typography treatments to works. I also discovered that behind theme-ui typography is Kyle Mathews who has been creating a ton of them. I kept having the same issue though and that was the body font wasn't being set so i resorted to using emotion core global and css to just set it... again i'll come back to this.

What i was able to do on [gatsby-mdx-embed](https://github.com/PaulieScanlon/gatsby-mdx-embed) though was to understand how to create a method for the provider so that once the plugin is installed that's all a user would have to do. It's similar to how `gatsby-plugin-theme-ui` works by using `gatsby-browser` and `gatsby-ssr` and using the `wrapRootElement` method to inject the MdxProvider.

This i discovered needs to be done in both files and in different ways. in `gatsby-browser` es6 imports work in `gatsby-ssr` you have to use require and node modules exports.

..both are required so that in dev and prod the MdxEmbedProvider wraps the root element. With this now working i'm almost ready for an early release.

...

## [Day 3](#day-3)

##### Jan 3 2020

This post is starting to feel like an agile standup so perhaps i'll treat it like one.

###### Yesterday

After writing yesterdays blog post i had a think about how i was gonna handle the headings with nested `<a>` styling in [gatsby-theme-gatstats](https://github.com/PaulieScanlon/gatsby-theme-gatstats) which was actually pretty easy. I'm using [theme-ui](https://theme-ui.com/) for everything so a little update to my headings object to style the child `<a>` was all that was needed.

```js
const headings = {
  ...
  a: {
    fontSize: 'inherit',
    fontWeight: 'inherit',
    lineHeight: 'inherit',
    color: 'inherit'
  }
}
```

Next i looked at how these `#` anchors should work. Typically in a site the browser jumps to where the `#` starts when clicked and if a link is shared with a `#` as part of the url when the page loads it'll move the page so the `#` link is at the top.

For this to work in my theme i needed to look at the `gatsby-browser` api. There's two methods that were required to make this to work.

- [onRouteUpdate](https://www.gatsbyjs.org/docs/browser-apis/#onRouteUpdate) which is called when a user changes routes, and also called when an `<a>` is clicked (if it has a `#`)
- [shouldUpdateScroll](https://www.gatsbyjs.org/docs/browser-apis/#shouldUpdateScroll) which allows us to influence the scroll position of the browser on load and also it would seem between route changes.

The main guts of this functionality is wrapped up in a little function i created in `gatsby-browser` which is called by both of the above methods.

```js
const anchorScroll = location => {
  if (location && location.hash) {
    const item = document.querySelectorAll(`a[href^="${location.hash}"]`)[0]
      .offsetTop
    const mainNavHeight = document.querySelector(`header`).offsetHeight
    setTimeout(() => {
      window.scrollTo({
        top: item - mainNavHeight,
        behavior: "smooth",
      })
    }, 50)
  }
}
```

In short all this is doing is finding the `<a>` element that contains the `#` which is found from the url / `location.hash` then scrolls to it. There's an offset in there because [gatsby-theme-gatstats](https://github.com/PaulieScanlon/gatsby-theme-gatstats) has a position fixed header so i needed to calculate the top position minus the height of the header so the selected `#` isn't under the header when the browser scrolls to it.

This all works well but i'm a little worried about my choice to use the native `window.scrollTo` method with `behavior: "smooth"` as some older browsers don't support this so if you're using IE 11 (ü§¢) can you let me know if it still works as intended?

I also had a little bit of twitter activity yesterday from a new user of [gatsby-theme-gatstats](https://github.com/PaulieScanlon/gatsby-theme-gatstats) who tweeted to ask me how to do something. He said he didn't want to raise as issue as he thought it was more him not knowing how to do it rather than it being a bug. My reply "was go ahead, raise an issue" Reason being is that if he's had problems with this particular "thing" then perhaps i should explain it better in the README so others don't have the same question.

I'm pretty new to open source and [gatsby-theme-gatstats](https://github.com/PaulieScanlon/gatsby-theme-gatstats) is the first real project i've had where users are getting in touch and / or rasing issues on GitHub. I think it's fantastic to be honest as it's quite difficult to know how your project will be used and whilst i tried to think of everything i know i've missed things so having other users point this out and let me know means i get to change and improve the project ... it's a win, win!

###### Today

Today i really want to focus on [gatsby-mdx-embed](https://github.com/PaulieScanlon/gatsby-mdx-embed) and get this converted to TypeScript and perhaps get Storybook setup.. but i do like the idea of using a Gatsby project to use as a documentation site so i'll probably have google around and see what's out there.

I'm also thinking in the background about the subjects i'm covering on this "standup" style post and which ones should be promoted to their own blog posts. The `<a>` `#` thing i did yesterday could be a good one to write up but i'm not sure i'll have time. For now at least my main focus is on getting [gatsby-mdx-embed](https://github.com/PaulieScanlon/gatsby-mdx-embed) stable and released.

## [Day 2](#day-2)

##### Jan 2 2020

Started this morning by fixing a bug with [gatsby-theme-gatstats](https://github.com/PaulieScanlon/gatsby-theme-gatstats). Part of the [dashboard](https://gatsby-theme-gatstats.netlify.com/) has a **Posts** chart displaying information gathered from the previous year and current years posts. I wasn't correctly checking that the chart would render correctly if there were no posts for the current year.

I've also noticed another bug which is the chart max range needs to be calculated from grabbing the highest count value from both of the year data arrays. I was previously only checking the current year data and creating the range from the hightest count value in that year but it's quite possible that the previous year will have a higher count meaning the line chart will get cut off.

I also need to investigate anchor tags in the theme so that they don't always take on the styling for `<a>` if nested within an `<h1>` This will come in handy should i want to add anchor tags to each heading from this 100DaysOfGatsby post.

## [Day 1](#day-1)

##### Jan 1 2020

Today is the first day of [#100DaysOfGatsby](https://twitter.com/hashtag/100DaysOfGatsby) and since i already have a blog in place i think i'm gonna just continue working on my various Gatsby projects and try to write a bit each day and then see where i'm at in 100 days.

I currently have a number of Gatsby plugin projects all on npm but all in various states of completeness, these are:

- [gatsby-theme-gatstats](https://github.com/PaulieScanlon/gatsby-theme-gatstats)
- [gatsby-remark-sticky-table](https://github.com/PaulieScanlon/gatsby-remark-sticky-table)
- [gatsby-remark-grid-system](https://github.com/PaulieScanlon/gatsby-remark-grid-system)
- [gatsby-mdx-routes](https://github.com/PaulieScanlon/gatsby-mdx-routes)
- [gatsby-mdx-embed](https://github.com/PaulieScanlon/gatsby-mdx-embed)

Today i've pushed a fairly stable commit to [gatsby-mdx-embed](https://github.com/PaulieScanlon/gatsby-mdx-embed) which i think pretty much solves the twitter, instagram and flickr embed problem. I'm not gonna release this to npm just yet as i've done with previous plugins because i'd like to get this properly tested and converted to TypeScript first.

[gatsby-mdx-embed](https://github.com/PaulieScanlon/gatsby-mdx-embed) is first and foremost an `MdxProvider` and when used in a Gatsby project along side `.mdx` it'll allow for media embed codes to be used without import by using the `MdxProvider` and it's `component` prop.

So far so good and i have the first 8 components in and working, although the instagram one seems a little flakey on iOS.

Lessons learned today are similar to issues i've experienced before regarding `gatsby-ssr` and `gatsby-browser`. Or more specifically the problems when attempting to use both together to accomplish similar things.

ie. if `gatsby-browser` relies on something that `gatsby-ssr` is gonna do which might not run synchronously. I made a change and it was worth the effort now `gatsby-browser` does all the heavy lifting things are working much better.

In the case of [gatsby-mdx-embed](https://github.com/PaulieScanlon/gatsby-mdx-embed) it was because i was using `gatsby-ssr` to inject the relevant provider scripts into the `<head>` and then using `gatsby-browser` to invoke them. This wasn't really working so making the `<script>` tags and appending them to `<head>` AND then invoking them from `gatsby-browser` proved more solid.

I'd really like to solve the instagram problem before moving on much further but getting the project converted to Typescript and then installing [Storybook](https://storybook.js.org/) sounds like it's gonna be way more fun.

I plan to open up and document a load of props to make each component more useful, adding widths to videos and or aspect ratios etc would be really cool. I haven't set up a TypeScript / Storybook repo for a while so this should be fun!

Once i'm happy [gatsby-mdx-embed](https://github.com/PaulieScanlon/gatsby-mdx-embed) is pretty solid i'm gonna switch out the temporary `Tweet` and `YouTube` components i hacked together in my theme [gatsby-theme-gatstats](https://github.com/PaulieScanlon/gatsby-theme-gatstats)

I'm gonna use this post as a kind of journal and update each day with things i'm working on of things i'm thinking about and would like to create more in depth posts for topics that warrant further explanation.
